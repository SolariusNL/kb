(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2532],{9084:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/q/udmux-restore-ip",function(){return n(726)}])},726:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return c},meta:function(){return i}});var r=n(5893),s=n(5190),a=n(7141);let i={title:"Restoring original IP address after proxy",description:"Learn how to restore original IP address with Udmux",slug:"udmux-restore-ip",category:"udmux",tags:["udmux","ddos","ip","proxy"],created_at:"February 22, 2024",last_updated_at:"February 22, 2024"},o=(0,a.A)(i);function l(e){let t={code:"code",h2:"h2",p:"p",pre:"pre",...(0,s.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.p,{children:"When your services traffic is routed through Solarius's Udmux network, we act as a reverse proxy. This allows us to route packets efficiently and cache static resources that are frequently requested. As a result, when responding to requests and logging them, your server will see the IP address of the Udmux server that the request was received on, rather than the original client's IP address."}),"\n",(0,r.jsx)(t.h2,{id:"restoring-original-ip-address",children:"Restoring original IP address"}),"\n",(0,r.jsxs)(t.p,{children:["To restore the original IP address of the client, you can pull the ",(0,r.jsx)(t.code,{children:"Ud-Client-IP"})," header from the request. This header is added by Udmux and contains the original client's IP address."]}),"\n",(0,r.jsxs)(t.p,{children:["Here's an example of how you can do this in Node.js using the ",(0,r.jsx)(t.code,{children:"express"})," framework:"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-javascript",children:'const express = require("express");\nconst app = express();\n\napp.use((req, res, next) => {\n  const clientIp = req.headers["ud-client-ip"];\n  console.log(`Request from client with IP: ${clientIp}`);\n  next();\n});\n\napp.get("/", (req, res) => {\n  res.send("Hello, world!");\n});\n\napp.listen(3000, () => {\n  console.log("Server is running on port 3000");\n});\n'})}),"\n",(0,r.jsxs)(t.p,{children:["In this example, we're using the ",(0,r.jsx)(t.code,{children:"express"})," middleware to pull the ",(0,r.jsx)(t.code,{children:"Ud-Client-IP"})," header from the request and log it to the console. You can then use this IP address for any other purposes, such as logging or rate limiting."]}),"\n",(0,r.jsx)(t.h2,{id:"limitations",children:"Limitations"}),"\n",(0,r.jsxs)(t.p,{children:["It's important to note that the ",(0,r.jsx)(t.code,{children:"Ud-Client-IP"})," header is only added to requests that are routed through Udmux. If a request bypasses Udmux and is sent directly to your server, the header will not be present. As a result, you should always check for the presence of the header before using it, and have a fallback mechanism in place for when it's not present."]})]})}function c(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,r.jsx)(o,{...e,children:(0,r.jsx)(l,{...e})})}},5190:function(e,t,n){"use strict";n.d(t,{a:function(){return U}});var r=n(5893),s=n(512),a=n(8008),i=n(967),Image=n(929),o=n(6536),l=n(3692),c=n(6283),Text=n(4410),d=n(7631),u=n.n(d);function h(e){let{error:t}=e;return(0,r.jsxs)("div",{className:u().wrapper,children:[(0,r.jsx)(Text.x,{className:u().label,children:"Error message:"}),(0,r.jsx)(Text.x,{className:u().error,children:t})]})}n(7294);var x=n(7010),p=n(5984),m=n(3043),_=n(7187),f=n(4251),g=n.n(f);function j(e){let{className:t,...n}=e,a=(0,p.rZ)();return(0,r.jsx)(m.V,{className:(0,s.Z)(g().root,t),icon:(0,r.jsx)(x.Z,{className:g().icon}),radius:"md",__vars:{"--docs-bq-code-bg-light":(0,_.m)(a.colors.blue[6],.2),"--docs-bq-code-bg-dark":(0,_.m)(a.colors.blue[4],.2)},...n})}var N=n(3520),v=n(7529),b=n(747),y=n(8543),k=n(9169),w=n.n(k);function M(e){let{yarnScript:t,npmScript:n}=e,[s,a]=(0,N._)({key:"script-tab",defaultValue:0});return(0,r.jsx)(y.Q,{classNames:{root:w().root},activeTab:s,onTabChange:a,code:[{fileName:"yarn",code:t,language:"bash",icon:(0,r.jsx)(v.z,{className:w().icon,size:16})},{fileName:"npm",code:n,language:"bash",icon:(0,r.jsx)(b._,{className:w().icon,size:16})}]})}function E(e){let{packages:t,dev:n}=e;return(0,r.jsx)(M,{yarnScript:"yarn add ".concat(n?"--dev ":"").concat(t),npmScript:"npm install ".concat(n?"--save-dev ":"").concat(t)})}var I=n(359),P=n.n(I);function q(e){let{id:t,children:n,order:i=2,...o}=e;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{id:t,"data-heading":n,"data-order":i,className:P().titleOffset}),(0,r.jsx)(a.D,{order:i,className:P().title,...o,children:(0,r.jsx)("a",{className:(0,s.Z)(P().titleLink,"mantine-focus-auto"),href:"#".concat(t),children:n})})]})}let L=e=>t=>(0,r.jsx)(q,{order:e,...t});function T(e){let{children:t}=e;return(0,r.jsx)(c.P,{className:P().code,code:t.props.children,language:function(e){let t=(e.props.className||"").match(RegExp("language-(?<lang>.*)"));return t&&t.groups&&t.groups.lang?t.groups.lang:"tsx"}(t)})}function S(e){return(0,r.jsx)("p",{className:P().paragraph,...e})}function C(e){return(0,r.jsx)("ul",{className:P().ul,...e})}function O(e){return(0,r.jsx)("li",{className:P().li,...e})}function z(e){let{href:t,...n}=e;return(0,r.jsx)(i.e,{className:P().link,href:t,...n})}function U(e){return{img:Image.E,ul:C,li:O,p:S,a:z,code:o.E,h1:L(1),h2:L(2),h3:L(3),h4:L(4),h5:L(5),h6:L(6),pre:T,Demo:l.B,InstallScript:E,ErrorMessage:h,blockquote:j,...e}}},7141:function(e,t,n){"use strict";n.d(t,{A:function(){return q}});var r=n(5893),s=n(3078),a=n(967),i=n(4920),o=n(8008),Text=n(4410),l=n(3507),c=n(6247),d=n(9008),u=n.n(d),h=n(1664),x=n.n(h),p=n(5372),m=n.n(p),_=n(7294),f=n(207),g=n.n(f);function j(e){let{icon:t,children:n,link:s}=e,a=s?(0,r.jsxs)("a",{href:s,target:"_blank",className:g().body,rel:"noreferrer",children:[(0,r.jsx)("div",{className:g().icon,children:t}),(0,r.jsx)("div",{className:g().content,children:n})]}):(0,r.jsxs)("div",{className:g().body,children:[(0,r.jsx)("div",{className:g().icon,children:t}),(0,r.jsx)("div",{className:g().content,children:n})]});return(0,r.jsx)("div",{className:g().root,children:a})}var N=n(1163),v=n(4342),b=n(2034),y=n(8565),k=n(6721),w=n(1379),M=n.n(w);function E(e){if(0===e.length)return -1;let t=e.reduce((e,t,n)=>Math.abs(e.position)<Math.abs(t.y)?e:{index:n,position:t.y},{index:0,position:e[0].y});return t.index}function I(){let[e,t]=(0,_.useState)(0),[n,s]=(0,_.useState)([]),a=(0,_.useRef)([]),i=(0,N.useRouter)(),o=n.filter(e=>e.depth>1),l=()=>{t(E(a.current.map(e=>e.getNode().getBoundingClientRect())))};if((0,_.useEffect)(()=>{let e=function(){let e=document.getElementById("mdx");return e?function(e){let t=[];for(let n=0;n<e.length;n+=1){let r=e[n];r.id&&t.push({depth:parseInt(r.getAttribute("data-order"),10),content:r.getAttribute("data-heading")||"",id:r.id,getNode:()=>document.getElementById(r.id)})}return t}(Array.from(e.querySelectorAll("[data-heading]"))):[]}();return a.current=e,s(e),t(E(e.map(e=>e.getNode().getBoundingClientRect()))),window.addEventListener("scroll",l),()=>window.removeEventListener("scroll",l)},[]),0===o.length)return null;let c=o.map((t,n)=>(0,r.jsx)(Text.x,{component:"a",fz:"sm",className:M().link,mod:{active:e===n},href:"#".concat(t.id),__vars:{"--toc-link-offset":"".concat(t.depth-1)},onClick:e=>{e.preventDefault(),i.replace("".concat(i.pathname,"#").concat(t.id))},children:t.content},t.id));return(0,r.jsx)(b.x,{component:"nav",className:M().wrapper,children:(0,r.jsx)("div",{className:M().inner,children:(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:M().header,children:[(0,r.jsx)(v.Z,{style:{width:(0,y.h)(20),height:(0,y.h)(20)},stroke:1.5}),(0,r.jsx)(Text.x,{className:M().title,children:"Table of contents"})]}),(0,r.jsx)(k.x.Autosize,{mah:"calc(100vh - ".concat((0,y.h)(140),")"),type:"never",offsetScrollbars:!0,children:(0,r.jsx)("div",{className:M().items,children:c})})]})})})}function P(e){let{meta:t,children:n}=e,d="".concat(t.title," | Solarius");return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(u(),{children:[(0,r.jsx)("title",{children:d}),(0,r.jsx)("meta",{itemProp:"name",content:d},"item-title"),(0,r.jsx)("meta",{property:"og:title",content:d},"og-title"),(0,r.jsx)("meta",{name:"twitter:title",content:d},"twitter-title"),(0,r.jsx)("meta",{property:"og:url",content:"https://kb.solarius.me/q/".concat(t.slug)},"og-url")]}),(0,r.jsxs)("article",{children:[(0,r.jsx)("header",{className:m().header,children:(0,r.jsxs)(s.W,{size:"md",children:[(0,r.jsx)(a.e,{component:x(),href:"/",underline:"hover",fz:"sm",children:(0,r.jsx)(i.z,{variant:"subtle",radius:"xl",leftSection:(0,r.jsx)(l.Z,{size:18,stroke:1.5}),children:"Back to all questions"})}),(0,r.jsx)(o.D,{className:m().title,children:t.title}),(0,r.jsx)("nav",{className:m().links,children:(0,r.jsx)(j,{icon:(0,r.jsx)(c.Z,{size:18,stroke:1.5}),link:"mailto:support@solarius.me?subject=Issue with ".concat(t.title),children:"Report an issue to Solarius"})}),(0,r.jsxs)(Text.x,{c:"dimmed",fz:"xs",mt:"md",children:["Last updated"," ",(0,r.jsx)(Text.x,{component:"time",dateTime:new Date(t.last_updated_at).toLocaleDateString(),c:"var(--mantine-color-text)",inherit:!0,children:t.last_updated_at})]})]})}),(0,r.jsxs)(s.W,{size:"md",className:m().inner,children:[(0,r.jsx)("div",{className:m().content,id:"mdx",children:n}),(0,r.jsx)(I,{})]})]})]})}function q(e){return t=>{let{children:n}=t;return(0,r.jsx)(P,{meta:e,children:n})}}},359:function(e){e.exports={paragraph:"MdxElements_paragraph__4fXCh",link:"MdxElements_link__J7fnd",ul:"MdxElements_ul__OOTjk",li:"MdxElements_li__3_j76",title:"MdxElements_title__l4zV5",titleLink:"MdxElements_titleLink__UU75K",titleOffset:"MdxElements_titleOffset__kBHVU",code:"MdxElements_code__yvlvb"}},7631:function(e){e.exports={wrapper:"MdxErrorMessage_wrapper__JlJDx",error:"MdxErrorMessage_error__XuiIB",label:"MdxErrorMessage_label__SsQTh"}},4251:function(e){e.exports={root:"MdxInfo_root___n6Nr",icon:"MdxInfo_icon__9t9jJ"}},9169:function(e){e.exports={root:"MdxNpmScript_root__yTuQb",icon:"MdxNpmScript_icon__OPgOf"}},5372:function(e){e.exports={header:"MdxLayout_header__0tel7",title:"MdxLayout_title__KyoNs",links:"MdxLayout_links__ikk4L",inner:"MdxLayout_inner__vHPN9",content:"MdxLayout_content__Pg8un"}},207:function(e){e.exports={root:"PageHeaderLink_root__wMV7V",label:"PageHeaderLink_label__eYp4m",body:"PageHeaderLink_body__yrqn0",icon:"PageHeaderLink_icon__8FTyU"}},1379:function(e){e.exports={wrapper:"TableOfContents_wrapper__4dG89",inner:"TableOfContents_inner__po5SO",link:"TableOfContents_link__fUzKF",header:"TableOfContents_header__1sSDD",title:"TableOfContents_title__owxbN",items:"TableOfContents_items__IQuAZ"}}},function(e){e.O(0,[486,9774,2888,179],function(){return e(e.s=9084)}),_N_E=e.O()}]);